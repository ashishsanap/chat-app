{"version":3,"sources":["api/dashboard/dashboard.controller.js"],"names":["profile","ref","DB","rad","x","Math","PI","getDistance","p1","p2","R","dLat","lat","dLong","long","a","sin","cos","c","atan2","sqrt","d","req","res","usersRef","child","once","snapshot","allUser","authData","Lat","Long","console","log","forEach","item","MobileNumber","val","push","userArr","dist","Password","Distance","send"],"mappings":";;;;;QAoBgBA,O,GAAAA,O;;AAnBhB;;;;;;AAEA,MAAMC,MAAMC,mBAAGD,GAAH,CAAO,QAAP,CAAZ,C,CAHA;;AAIA,SAASE,GAAT,CAAaC,CAAb,EAAgB;AACd,SAAOA,IAAIC,KAAKC,EAAT,GAAc,GAArB;AACD;;AAED,SAASC,WAAT,CAAqBC,EAArB,EAAyBC,EAAzB,EAA6B;AAC3B,QAAMC,IAAI,OAAV,CAD2B,CACR;AACnB,QAAMC,OAAOR,IAAIM,GAAGG,GAAH,GAASJ,GAAGI,GAAhB,CAAb;AACA,QAAMC,QAAQV,IAAIM,GAAGK,IAAH,GAAUN,GAAGM,IAAjB,CAAd;AACA,QAAMC,IAAIV,KAAKW,GAAL,CAASL,OAAO,CAAhB,IAAqBN,KAAKW,GAAL,CAASL,OAAO,CAAhB,CAArB,GACJN,KAAKY,GAAL,CAASd,IAAIK,GAAGI,GAAP,CAAT,IAAwBP,KAAKY,GAAL,CAASd,IAAIM,GAAGG,GAAP,CAAT,CAAxB,GACAP,KAAKW,GAAL,CAASH,QAAQ,CAAjB,CADA,GACsBR,KAAKW,GAAL,CAASH,QAAQ,CAAjB,CAF5B;AAGA,QAAMK,IAAI,IAAIb,KAAKc,KAAL,CAAWd,KAAKe,IAAL,CAAUL,CAAV,CAAX,EAAyBV,KAAKe,IAAL,CAAU,IAAIL,CAAd,CAAzB,CAAd;AACA,QAAMM,IAAIX,IAAIQ,CAAd;AACA,SAAOG,CAAP,CAT2B,CASjB;AACX;;AAEM,SAASrB,OAAT,CAAiBsB,GAAjB,EAAsBC,GAAtB,EAA2B;AAChC,QAAMC,WAAWvB,IAAIwB,KAAJ,CAAU,OAAV,CAAjB;AACAD,WAASE,IAAT,CAAc,OAAd,EAAwBC,QAAD,IAAc;AACnC,UAAMC,UAAU,EAAhB;AACA,UAAMhB,MAAMU,IAAIO,QAAJ,CAAaC,GAAzB;AACA,UAAMhB,OAAOQ,IAAIO,QAAJ,CAAaE,IAA1B;AACA,UAAMvB,KAAK;AACTI,SADS;AAETE;AAFS,KAAX;AAIAkB,YAAQC,GAAR,CAAYzB,EAAZ;AACAmB,aAASO,OAAT,CAAkBC,IAAD,IAAU;AACzB,UAAIb,IAAIO,QAAJ,CAAaO,YAAb,KAA8BD,KAAKE,GAAL,GAAWD,YAA7C,EAA2D;AAAER,gBAAQU,IAAR,CAAaH,KAAKE,GAAL,EAAb;AAA2B;AACzF,KAFD;AAGA,UAAME,UAAU,EAAhB;AACAX,YAAQM,OAAR,CAAiBC,IAAD,IAAU;AACxB,YAAM1B,KAAK;AACTG,aAAKuB,KAAKL,GADD;AAEThB,cAAMqB,KAAKJ;;AAFF,OAAX;AAKA,UAAIvB,GAAGI,GAAH,IAAUJ,GAAGM,IAAb,IAAqBL,GAAGG,GAAxB,IAA+BH,GAAGK,IAAtC,EAA4C;AAC1C,cAAM0B,OAAOjC,YAAYC,EAAZ,EAAgBC,EAAhB,CAAb;AACAuB,gBAAQC,GAAR,CAAY,IAAZ,EAAkBO,IAAlB;AACA,YAAIA,OAAO,IAAX,EAAiB;AACf,iBAAOL,KAAKM,QAAZ;AACAN,eAAKO,QAAL,GAAgBF,IAAhB;AACAD,kBAAQD,IAAR,CAAaH,IAAb;AACD;AACF;AACF,KAfD;AAgBAZ,QAAIoB,IAAJ,CAASJ,OAAT;AACD,GA9BD;AA+BD","file":"dashboard.controller.js","sourcesContent":["/* eslint-disable import/prefer-default-export */\nimport DB from '../../config/firebase';\n\nconst ref = DB.ref('server');\nfunction rad(x) {\n  return x * Math.PI / 180;\n}\n\nfunction getDistance(p1, p2) {\n  const R = 6378137; // Earthâ€™s mean radius in meter\n  const dLat = rad(p2.lat - p1.lat);\n  const dLong = rad(p2.long - p1.long);\n  const a = Math.sin(dLat / 2) * Math.sin(dLat / 2) +\n        Math.cos(rad(p1.lat)) * Math.cos(rad(p2.lat)) *\n        Math.sin(dLong / 2) * Math.sin(dLong / 2);\n  const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));\n  const d = R * c;\n  return d; // returns the distance in meter\n}\n\nexport function profile(req, res) {\n  const usersRef = ref.child('users');\n  usersRef.once('value', (snapshot) => {\n    const allUser = [];\n    const lat = req.authData.Lat;\n    const long = req.authData.Long;\n    const p1 = {\n      lat,\n      long,\n    };\n    console.log(p1)\n    snapshot.forEach((item) => {\n      if (req.authData.MobileNumber !== item.val().MobileNumber) { allUser.push(item.val()); }\n    });\n    const userArr = [];\n    allUser.forEach((item) => {\n      const p2 = {\n        lat: item.Lat,\n        long: item.Long,\n\n      };\n      if (p1.lat && p1.long && p2.lat && p2.long) {\n        const dist = getDistance(p1, p2);\n        console.log('dd', dist);\n        if (dist < 5000) {\n          delete item.Password;\n          item.Distance = dist;\n          userArr.push(item);\n        }\n      }\n    });\n    res.send(userArr);\n  });\n}\n"]}